apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: airflow

resources:
- ../../base/airflow
- configmap-prod.yaml
- configmap-dev.yaml
- salesforce-externalsecret-prod.yaml
- salesforce-externalsecret-dev.yaml
- warehouse-externalsecret-prod.yaml
- warehouse-externalsecret-dev.yaml
- connection-secret-patch.yaml
- certificate.yaml

patches:
- path: release-patch.yaml
  target:
    kind: HelmRelease
    name: airflow

replacements:
- source:
    kind: Secret
    name: airflow-db-production-cnpg-v1-app
    fieldPath: data.uri
  targets:
  - select:
      kind: Secret
      name: airflow-metadata-connection
    fieldPaths:
    - data.connection